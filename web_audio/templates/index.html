<html>
    <head>
    </head>
    <body><script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
            
        <script>
            var socket = io();
            socket.on('server_response', function(msg) {
                $('#log').append('<p>Received: ' + msg.data + '</p>');
            });

            class MyWorkletNode extends AudioWorkletNode{
                constructor(){
                    super(audioCtx, 'ws-receiver', {'processorOptions':{'wsurl':'wss://localhost:5000/socket.io'}});
                    var p = this.port;
                    socket.on('audio_data', function(msg){
                        p.postMessage(msg['data']);
                    });
                }
            }


            async function play(){
                audioCtx = new AudioContext({'sampleRate':4000});
                await audioCtx.audioWorklet.addModule('static/wsworklet.js', );
                mysource = new MyWorkletNode();
                mysource.connect(audioCtx.destination);
            };

            function call(){
                socket.emit('client_event', {data: $('#emit_data').val()});
            }
        </script>
        <button onClick="play()">PLAY2</button>
        <button onClick="call()">CALL</button>
        <input id="emit_data" type="text" value="ee"/>
        <div id="log">
            
        </div>
    </body>
</html>
